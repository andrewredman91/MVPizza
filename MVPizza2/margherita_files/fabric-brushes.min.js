"use strict";function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t){t.Point.prototype.angleBetween=function(t){return Math.atan2(this.x-t.x,this.y-t.y)},t.Point.prototype.normalize=function(t){null==t&&(t=1);var e=this.distanceFrom({x:0,y:0});return e>0&&(this.x=this.x/e*t,this.y=this.y/e*t),this}}(fabric),function(t){t.util.getRandom=function(t,e){return e=e||0,Math.random()*((t||1)-e)+e},t.util.clamp=function(t,e,i){return"number"!=typeof i&&(i=0),t>e?e:t<i?i:t},t.util.drawCircle=function(t,e,i,r,s){t.fillStyle=s,t.beginPath(),t.arc(e,i,r,0,2*Math.PI,!1),t.closePath(),t.fill()},t.util.distance=function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}}(fabric),fabric.BlobsBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,lastDot:null,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.canvas.contextTop;this._saveAndTransform(e);var i=this.addPoint(t);if(this.dot(e,i),fabric.util.getRandom(100,0)<=15){var r=this.addSplash(t);this.dot(e,r)}e.restore()},dot:function(t,e){e&&fabric.util.drawCircle(t,e.x,e.y,e.radius,e.fill)},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this.lastPoint=null,this.drawDot(t)},_render:function(){var t=this.canvas.contextTop,e=i.length,i=this.points;this._saveAndTransform(t);for(var r=0;r<e;r++)this.dot(t,i[r]);t.restore()},onMouseMove:function(t){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var r=[];for(t=0,e=this.points.length;t<e;t++){var s=this.points[t],a=new fabric.Circle({radius:s.radius,left:s.x,top:s.y,originX:"center",originY:"center",fill:s.fill});r.push(a)}var n=new fabric.Group(r);n.canvas=this.canvas,this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){if(!(null!==this.lastPoint&&this.lastPoint.distanceFrom(t)<this.width/4)){this.lastPoint=t;var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(2,this.width-20),this.width)/2;return e.radius=i,e.fill=this.color,this.points.push(e),e}},addSplash:function(t){var e=t.x+fabric.util.getRandom(1.5*this.width,-1.5*this.width),i=t.y+fabric.util.getRandom(1.5*this.width,-1.5*this.width),r=fabric.util.getRandom(Math.max(3,this.width/5),1),s=new fabric.Point(e,i);return s.radius=r,s.fill=this.color,this.points.push(s),s}}),function(){var t=fabric.StaticCanvas.prototype.__setBgOverlayColor,e=fabric.StaticCanvas.prototype.__setBgOverlay,i=fabric.StaticCanvas.prototype._setSVGBgOverlayColor;fabric.util.object.extend(fabric.StaticCanvas.prototype,{backgroundColor:void 0,overlayColor:void 0,__setBgOverlayColor:function(e,i,r,s){if(i&&i.isType&&i.isType("rect"))this[e]=i,i.set(s),r&&r(this[e]);else{var a=this,n=function(){a[e]=new fabric.Rect(fabric.util.object.extend({width:a.width,height:a.height,fill:a[e]},s)),r&&r(a[e])};t.call(this,e,i,n),!i||!i.colorStops||i instanceof fabric.Gradient||n()}return this},setBackgroundColor:function(t,e,i){return this.__setBgOverlayColor("backgroundColor",t,e,i)},setOverlayColor:function(t,e,i){return this.__setBgOverlayColor("overlayColor",t,e,i)},__setBgOverlay:function(t,i,r,s){var a=this;"backgroundColor"!==t&&"overlayColor"!==t||!i||"object"!==_typeof(i)||"rect"!==i.type?e.call(this,t,i,r,s):fabric.util.enlivenObjects([i],(function(e){a[t]=e[0],r[t]=!0,s&&s()}))},_setSVGBgOverlayColor:function(t,e,r){var s=this[e+"Color"];if(s&&s.isType&&s.isType("rect")){var a=s.excludeFromExport||this[e]&&this[e].excludeFromExport;s&&!a&&s.toSVG&&t.push(s.toSVG(r))}else i.call(this,t,e,r)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"],r=this[e+"Image"],s=this.viewportTransform,a=this[e+"Vpt"];(i||r)&&(i||r)&&(t.save(),a&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),i&&i.render(t),r&&r.render(t),t.restore())}});var r=fabric.Object.prototype.toObject,s=fabric.Object.prototype._createBaseSVGMarkup;fabric.util.object.extend(fabric.Object.prototype,{erasable:!0,getEraser:function(){return this.clipPath&&this.clipPath.eraser?this.clipPath:null},toObject:function(t){return r.call(this,["erasable"].concat(t))},eraserToSVG:function(t){var e=this.getEraser();if(e){var i=e._objects[0].fill;e._objects[0].fill="white",e.clipPathId="CLIPPATH_"+fabric.Object.__uid++;var r=["<defs>","<mask "+['id="'+e.clipPathId+'"'].join(" ")+" >",e.toSVG(t.reviver),"</mask>","</defs>"];return e._objects[0].fill=i,r.join("\n")}return""},_createBaseSVGMarkup:function(t,e){var i=this.getEraser();if(i){var r=this.eraserToSVG(e);this.clipPath=null;var a=s.call(this,t,e);return this.clipPath=i,[r,a.replace(">",'mask="url(#'+i.clipPathId+')" >')].join("\n")}return s.call(this,t,e)}});var a=fabric.Group.prototype.toObject;fabric.util.object.extend(fabric.Group.prototype,{toObject:function(t){return a.call(this,["eraser"].concat(t))}}),fabric.util.object.extend(fabric.Canvas.prototype,{isErasing:function(){return this.isDrawingMode&&this.freeDrawingBrush&&"eraser"===this.freeDrawingBrush.type&&this.freeDrawingBrush._isErasing},renderAll:function(){if(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),!this.isErasing()){this.hasLostContext&&this.renderTopLayer(this.contextTop);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this}this.freeDrawingBrush._render()}}),fabric.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{type:"eraser",_ready:!1,_drawOverlayOnTop:!1,_isErasing:!1,initialize:function(t){this.callSuper("initialize",t),this._renderBound=this._render.bind(this),this.render=this.render.bind(this)},hideObject:function(t){t&&(t._originalOpacity=t.opacity,t.set({opacity:0}))},restoreObjectVisibility:function(t){t&&t._originalOpacity&&(t.set({opacity:t._originalOpacity}),t._originalOpacity=void 0)},prepareCanvasBackgroundForLayer:function(t){if("overlay"!==t){var e=this.canvas,i=e.get("backgroundImage"),r=e.get("backgroundColor"),s="top"===t;i&&i.erasable===!s&&this.hideObject(i),r&&r.erasable===!s&&this.hideObject(r)}},prepareCanvasOverlayForLayer:function(t){var e=this.canvas,i=e.get("overlayImage"),r=e.get("overlayColor");if("bottom"===t)return this.hideObject(i),this.hideObject(r),!1;var s="top"===t,a=i&&!i.erasable||r&&!r.erasable;return i&&i.erasable===!s&&this.hideObject(i),r&&r.erasable===!s&&this.hideObject(r),a},restoreCanvasDrawables:function(){var t=this.canvas;this.restoreObjectVisibility(t.get("backgroundImage")),this.restoreObjectVisibility(t.get("backgroundColor")),this.restoreObjectVisibility(t.get("overlayImage")),this.restoreObjectVisibility(t.get("overlayColor"))},prepareCollectionTraversal:function(t){var e=this;t.forEachObject((function(t){t.forEachObject?e.prepareCollectionTraversal(t):t.erasable&&e.hideObject(t)}))},restoreCollectionTraversal:function(t){var e=this;t.forEachObject((function(t){t.forEachObject?e.restoreCollectionTraversal(t):e.restoreObjectVisibility(t)}))},prepareCanvasObjectsForLayer:function(t){"bottom"===t&&this.prepareCollectionTraversal(this.canvas)},restoreCanvasObjectsFromLayer:function(t){"bottom"===t&&this.restoreCollectionTraversal(this.canvas)},prepareCanvasForLayer:function(t){return this.prepareCanvasBackgroundForLayer(t),this.prepareCanvasObjectsForLayer(t),this.prepareCanvasOverlayForLayer(t)},restoreCanvasFromLayer:function(t){this.restoreCanvasDrawables(),this.restoreCanvasObjectsFromLayer(t)},renderBottomLayer:function(){var t=this.canvas;this.prepareCanvasForLayer("bottom"),t.renderCanvas(t.getContext(),t.getObjects().filter((function(t){return!t.erasable||t.isType("group")}))),this.restoreCanvasFromLayer("bottom")},renderTopLayer:function(){var t=this.canvas;this._drawOverlayOnTop=this.prepareCanvasForLayer("top"),t.renderCanvas(t.contextTop,t.getObjects()),this.callSuper("_render"),this.restoreCanvasFromLayer("top")},renderOverlay:function(){this.prepareCanvasForLayer("overlay");var t=this.canvas,e=t.contextTop;this._saveAndTransform(e),t._renderOverlay(e),e.restore(),this.restoreCanvasFromLayer("overlay")},_saveAndTransform:function(t){this.callSuper("_saveAndTransform",t),t.globalCompositeOperation="destination-out"},needsFullRender:function(){return this.callSuper("needsFullRender")||this._drawOverlayOnTop},onMouseDown:function(t,e){this.canvas._isMainEvent(e.e)&&(this._prepareForDrawing(t),this._captureDrawingPath(t),this._isErasing=!0,this.canvas.fire("erasing:start"),this._ready=!0,this._render())},_render:function(){this._ready&&(this.isRendering=1,this.renderBottomLayer(),this.renderTopLayer(),this.renderOverlay(),this.isRendering=0)},render:function(){return!!this._isErasing&&(this.isRendering?this.isRendering=fabric.util.requestAnimFrame(this._renderBound):this._render(),!0)},_addPathToObjectEraser:function(t,e){var i,r=this;if(t.forEachObject)t.forEachObject((function(t){t.erasable&&r._addPathToObjectEraser(t,e)}));else{if(t.getEraser())i=t.clipPath;else{var s=t._getNonTransformedDimensions(),a=new fabric.Rect({width:s.x,height:s.y,clipPath:t.clipPath,originX:"center",originY:"center"});i=new fabric.Group([a],{eraser:!0})}e.clone((function(e){e.globalCompositeOperation="destination-out";var r=fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(t.calcTransformMatrix()),e.calcTransformMatrix());fabric.util.applyTransformToObject(e,r),i.addWithUpdate(e),t.set({clipPath:i,dirty:!0})}))}},applyEraserToCanvas:function(t){var e=this.canvas,i={};return["backgroundImage","backgroundColor","overlayImage","overlayColor"].forEach((function(r){var s=e[r];s&&s.erasable&&(this._addPathToObjectEraser(s,t),i[r]=s)}),this),i},_finalizeAndAddPath:function(){var t=this.canvas.contextTop,e=this.canvas;t.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate)),e.clearContext(e.contextTop),this._isErasing=!1;var i=this._points&&this._points.length>1?this.convertPointsToSVGPath(this._points).join(""):"M 0 0 Q 0 0 0 0 L 0 0";if("M 0 0 Q 0 0 0 0 L 0 0"===i)return e.fire("erasing:end"),void e.requestRenderAll();var r=this.createPath(i);e.fire("before:path:created",{path:r});var s=this.applyEraserToCanvas(r),a=this,n=[];e.forEachObject((function(t){t.erasable&&t.intersectsWithObject(r)&&(a._addPathToObjectEraser(t,r),n.push(t))})),e.fire("erasing:end",{path:r,targets:n,drawables:s}),e.requestRenderAll(),r.setCoords(),this._resetShadow(),e.fire("path:created",{path:r})}})}(),fabric.MarkerBrush=fabric.util.createClass(fabric.BaseBrush,{width:2,_strokes:[],_lines:[],_added:0,initialize:function(t,e){e=e||{},this.canvas=t,this.ctx=t.contextTop,this.width=e.width||t.freeDrawingBrush.width,this.color=e.color||t.freeDrawingBrush.color},addPoint:function(t){var e=this._strokes.length;if(!(e>1&&t.x===this._strokes[e-1].x&&t.y===this._strokes[e-1].y)){if(e>0)if(fabric.util.distance(this._strokes[e-1],t)<2)return;this._strokes.push({x:t.x,y:t.y}),this.addLines()}},addLines:function(){if(!(this._strokes.length<2)){var t=this._strokes.length,e=.1*this.width,i=this._strokes[t-1],r=this._strokes[t-2],s={p1:{x:i.x+e,y:i.y+e},p2:{x:r.x+e,y:r.y+e},width:this.lineWidth()};this._lines.push(s);var a={p1:{x:i.x-e,y:i.y-e},p2:{x:r.x-e,y:r.y-e},width:this.lineWidth()};this._lines.push(a)}},_render:function(){if(!(this._lines.length<1)){var t=this.ctx;t.save(),t.setLineDash([]),this._saveAndTransform(t),t.beginPath();var e=this._lines[this._lines.length-1],i=this._lines[this._lines.length-2];e&&(t.lineWidth=e.width,t.moveTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y),t.stroke()),i&&(t.lineWidth=i.width,t.moveTo(i.p1.x,i.p1.y),t.lineTo(i.p2.x,i.p2.y),t.stroke()),t.restore()}},lineWidth:function(){var t=.5*this.width;return Math.random()<.2&&(t*=.6),t},onMouseDown:function(t){var e=this.ctx;this._strokes.length=0,this._lines.length=0,e.strokeStyle=this.color,e.lineCap="square",e.lineWidth=this.width,this.addPoint(t)},onMouseMove:function(t){this.addPoint(t),this._render(t)},onMouseUp:function(t){this.addPoint(t.pointer);var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var i=[],r=0;r<this._lines.length-1;r++){var s=this._lines[r],a=s.width/2;i.push(new fabric.Line([s.p1.x-a,s.p1.y-a,s.p2.x-a,s.p2.y-a],{stroke:this.color,strokeWidth:s.width,strokeLineCap:"square"}))}var n=new fabric.Group(i);this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()}}),fabric.ScratchBrush=fabric.util.createClass(fabric.BaseBrush,{width:2,_lastPoint:null,_brushWidth:0,_strokes:[],initialize:function(t,e){e=e||{},this.canvas=t,this.ctx=t.contextTop,this.width=e.width||t.freeDrawingBrush.width,this.color=e.color||t.freeDrawingBrush.color},_render:function(t){if(t){var e=this.ctx;e.save(),e.setLineDash([]),this._saveAndTransform(e);var i=Math.max(2,(this.width-this._brushWidth)/2),r=t.x+fabric.util.getRandomInt(-i,i),s=t.y+fabric.util.getRandomInt(-i,i);this._strokes.push(new fabric.Point(r,s));var a=this._strokes.length-1;if(a>0){var n=this._strokes[a-1],o=this._strokes[a];e.lineWidth=this._brushWidth,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.stroke(),e.restore()}}},onMouseDown:function(t){this._brushWidth=Math.max(2,Math.round(this.width/5)),this._strokes.length=0,this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this._brushWidth,this.ctx.lineCap="round",this._strokes.push(new fabric.Point(t.x,t.y))},onMouseMove:function(t){this._render(t)},onMouseUp:function(t){this._strokes.push(new fabric.Point(t.pointer.x,t.pointer.y));var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var i=[],r=0;r<this._strokes.length-1;r++){var s=this._strokes[r],a=this._strokes[r+1],n=this._brushWidth/2;i.push(new fabric.Line([s.x-n,s.y-n,a.x-n,a.y-n],{stroke:this.color,strokeWidth:this._brushWidth,strokeLineCap:"round"}))}var o=new fabric.Group(i);this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()}}),fabric.SpeedBrush=fabric.util.createClass(fabric.BaseBrush,{width:2,_strokes:[],initialize:function(t,e){e=e||{},this.canvas=t,this.ctx=t.contextTop,this.width=e.width||t.freeDrawingBrush.width,this.color=e.color||t.freeDrawingBrush.color},addPoint:function(t){if(!(this._strokes.length>1&&t.x===this._strokes[this._strokes.length-1].x&&t.y===this._strokes[this._strokes.length-1].y)){var e={x:t.x,y:t.y,width:this.width};if(!(this._strokes.length<=1)){var i=this._strokes.length-1,r=this._strokes[i].width,s=this.width/6,a=fabric.util.distance(this._strokes[i],t),n=this.width+a;return a<1&&(n=this.width),r>n?(e.width=r-s,void this._strokes.push(e)):r<n?(e.width=r+s,void this._strokes.push(e)):void this._strokes.push(e)}this._strokes.push(e)}},_render:function(){var t=this.ctx;t.save(),t.setLineDash([]),this._saveAndTransform(t);var e=this._strokes.length-1;if(e>0){var i=this._strokes[e-1],r=this._strokes[e];t.lineWidth=i.width,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.stroke(),t.restore()}},onMouseDown:function(t){this._strokes.length=0,this.ctx.strokeStyle=this.color,this.ctx.lineCap="round",this.addPoint(t)},onMouseMove:function(t){this.addPoint(t),this._render(t)},onMouseUp:function(t){this.addPoint(t.pointer);var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var i=[],r=0;r<this._strokes.length-1;r++){var s=this._strokes[r+1],a=this._strokes[r],n=a.width/2;i.push(new fabric.Line([s.x-n,s.y-n,a.x-n,a.y-n],{stroke:this.color,strokeWidth:a.width,strokeLineCap:"round"}))}var o=new fabric.Group(i);this.canvas.add(o),this.canvas.fire("path:created",{path:o});var h=this.ctx;this.canvas.clearContext(h),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()}}),fabric.SplatterBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,dotWidth:1,dotWidthVariance:1,density:1,radius:1,initialize:function(t){this.canvas=t,this.newSplatter=[],this.splatter=[]},onMouseDown:function(t){this.density=Math.floor(Math.max(3,this.width/4)),this.radius=this.width/2,this.splatter.length=0,this.canvas.clearContext(this.canvas.contextTop),this.addSprayChunk(t),this.render(this.newSplatter)},onMouseMove:function(t){this.addSprayChunk(t),this.render(this.newSplatter)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=this.splatter.length,r=0;r<i;r++){var s=this.splatter[r],a=new fabric.Circle({left:s.x,top:s.y,radius:s.r,fill:this.color});e.push(a)}var n=new fabric.Group(e);this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},render:function(t){var e=this.canvas.contextTop;e.fillStyle=this.color;var i=t.length;this._saveAndTransform(e);for(var r=0;r<i;r++){var s=t[r];fabric.util.drawCircle(e,s.x+s.r,s.y+s.r,s.r,this.color)}e.restore()},addSprayChunk:function(t){this.newSplatter=[];for(var e=0;e<this.density;e++){var i=fabric.util.getRandomInt(Math.max(2,Math.floor(this.width/6)),Math.max(6,Math.ceil(this.width/3)))/2,r=fabric.util.getRandomInt(t.x-this.radius,t.x+this.radius),s=fabric.util.getRandomInt(t.y-this.radius,t.y+this.radius);if(!this.collide(r,s,i)){var a=new fabric.Point(r,s);a.r=i,this.newSplatter.push(a),this.splatter.push(a)}}},collide:function(t,e,i){for(var r=this.splatter.length,s=0;s<r;s++){var a=this.splatter[s],n=a.r+i;if(t>=a.x-n&&t<=a.x+n&&e>=a.y-n&&e<=a.y+n)return!0}return!1}});
//# sourceMappingURL=../build-maps/fabric-brushes.min.js.map
